function doGet(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  var data = sheet.getDataRange().getValues();

  // 1. Check if the request is from Python (Colab)
  // We look for 'python-requests' in the user agent
  var userAgent = HtmlService.getUserAgent();
  
  if (userAgent.indexOf('python') !== -1 || e.parameter.format === 'json') {
    // Return the raw brackets [] for the game to read
    return ContentService.createTextOutput(JSON.stringify(data.slice(1)))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  // 2. Otherwise, for you (in the browser), show the Website
  var tmp = HtmlService.createTemplateFromFile('index');
  tmp.data = data.slice(1); // Give the table data to the HTML
  
  return tmp.evaluate()
      .setTitle("UP-DOWN GAME: SCOREBOARD")
      .addMetaTag('viewport', 'width=device-width, initial-scale=1')
      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

// Keep your doPost exactly as it was, it works fine!
function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  var record = JSON.parse(e.postData.contents);
  var data = sheet.getDataRange().getValues();
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0] == record.lvl) {
      sheet.getRange(i + 1, 2).setValue(data[i][1] + record.w);
      sheet.getRange(i + 1, 3).setValue(data[i][2] + record.d);
      sheet.getRange(i + 1, 4).setValue(data[i][3] + record.l);
      return ContentService.createTextOutput("Success");
    }
  }
}
